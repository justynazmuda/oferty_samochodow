---
title: "Oferty samochodÃ³w"
author: "Justyna Zmuda, Aleksandra Goczyska, Aurelia SudoÅ‚"
date: "2024-11-23"
output: html_document
header-includes:
  - |
    <style>
      h1 { color: #461220; }
      h2 { color: #8c2f39; }
      h3 { color: #b23a48; }
      h4 { color: #fcb9b2; }
    </style>
---

# WstÄ™p

Celem niniejszego raportu jest zbadanie polskiego rynku samochodÃ³w na podstawie danych pochodzÄ…cych z portalu Otomoto.pl. Zbadano jak na cenÄ™ auta wpÅ‚ywa nazwa producenta, rok wyprodukowania samochodu oraz przebieg, a takÅ¼e wojewÃ³dztwo, w ktÃ³rym zostaÅ‚o wystawione na sprzedaÅ¼. Raport wykonano na podstawie analizy cen aut oraz ich wybranych cech. Analiza obejmuje liczbÄ™ brakÃ³w danych, procent brakÃ³w w poszczegÃ³lnych kolumnach, a takÅ¼e wzorce brakÃ³w oraz wizualizacje przedstawiajÄ…ce od czego zaleÅ¼y cena wybranych aut.

# Instalacja i Wczytanie niezbÄ™dnych bibliotek oraz danych

## Wczytanie oraz instalacja bibliotek

Krok pierwszy to zainstalowanie bibliotek potrzebnych do prawidÅ‚owego wykonania analizy. MiÄ™dzy innymi â€“ finalfit do modelowania regresji, mice do imputacji brakÃ³w danych, qwraps2 do raportÃ³w statystycznych oraz ggplo2 do tworzenia wykresÃ³w potrzebnych do analizy.

```{r 1, message=FALSE, warning=FALSE, include=FALSE}
library(finalfit)
library(mice)
library(naniar)
library(VIM)
library(Amelia)
library(qwraps2)
library(corrplot)
library(dplyr)
library(ggplot2)
library(dunn.test)

```

## Wczytanie danych

NasÄ™tpnym krokiem jest wczytanie danych, ktÃ³re po wyczyszczeniu bÄ™dÄ… bazÄ… do przeprowadzenia analizy. Dane zostaÅ‚y wczytane z pliku samochody_new.csv.

```{r 2, message=FALSE, warning=FALSE, include=FALSE}
samochody_new <- read.csv("samochody_new.csv", stringsAsFactors = FALSE)
if (file.exists("samochody_new.csv")) {
  samochody_final <- read.csv("samochody_new.csv")
} else {
  stop("Plik 'samochody_new.csv' nie zostaÅ‚ znaleziony.")
}
```

## Sprawdzenie czy w danych sÄ… braki

### Liczba brakÃ³w danych w kaÅ¼dej kolumnie

Sprawdzenie czy w kolumnach wystÄ™pujÄ… braki danych

```{r missing-values-count, echo=FALSE, message=FALSE, warning=FALSE}
# Liczba brakÃ³w danych
print("Liczba brakÃ³w danych w kaÅ¼dej kolumnie:")
colSums(is.na(samochody_new))
```

### Procent brakÃ³w danych w kaÅ¼dej kolumnie

Kolejnym krokiem w wykryciu brakÃ³w danych jest obliczenie procentowego udziaÅ‚u brakÃ³w danych w kaÅ¼dej kolumnie analizowanego pliku.

```{r missing-values-percent, echo=FALSE, message=FALSE, warning=FALSE}
# Procent brakÃ³w danych
print("Procent brakÃ³w danych w kaÅ¼dej kolumnie:")
colMeans(is.na(samochody_new)) * 100
```

## Wzorce brakÃ³w danych

WaÅ¼ne jest takÅ¼e okreÅ›lenie, identyfikacja oraz klasyfikacja brakujÄ…cych wartoÅ›ci.

```{r 5, echo=FALSE, message=FALSE, warning=FALSE}
print("Macierz wzorcÃ³w brakÃ³w danych:")
md.pattern(samochody_new) 
```

```{r 6, echo=FALSE, message=FALSE, warning=FALSE}
gg_miss_fct(x = samochody_new, fct = year)
```

```{r 7, echo=FALSE, message=FALSE, warning=FALSE}
gg_miss_upset(samochody_new)
```

```{r 8, echo=FALSE, message=FALSE, warning=FALSE}
missmap(samochody_new)
```

```{r 9, echo=FALSE, message=FALSE, warning=FALSE}
md.pattern(samochody_new, plot = FALSE)
```

```{r 10, echo=FALSE, message=FALSE, warning=FALSE}
aggr(samochody_new, col = c("darkred", "pink"), numbers = TRUE, sortVars = TRUE, labels = names(samochody_new), cex.axis = 0.7, gap = 3, ylab = c("Braki danych", "CzÄ™stotliwoÅ›Ä‡"))

```

# Czyszczenie danych

## Wczytanie oraz instalacja bibliotek

Instalowanie bibliotek potrzebnych do dalszej analizy miÄ™dzy innymi editrules, deducorrect oraz ISLR.

```{r 11, message=FALSE, warning=FALSE, include=FALSE}
library(editrules)
library(deducorrect)
library(ISLR)

```

## Wykrywanie brakÃ³w danych

Identyfikacja, lokalizacja oraz cena skali brakÃ³w w danych.

```{r 12, echo=FALSE, message=FALSE, warning=FALSE}

sum(complete.cases(samochody_new))
nrow(samochody_new[complete.cases(samochody_new), ]) / nrow(samochody_new)*100
 

is.special <- function(x){
  if (is.numeric(x)) !is.finite(x) else is.na(x)
}

sapply(samochody_new, is.special)

for (n in colnames(samochody_new)){
  is.na(samochody_new[[n]]) <- is.special(samochody_new[[n]])
}
summary(samochody_new)

```

## Sprawdzanie i naprawa spÃ³jnoÅ›ci danych

Identyfikacja problemÃ³w z niespÃ³jnoÅ›ciÄ… danych oraz metody naprawy tak aby analiza byÅ‚a rzetelna i wiarygodna.

```{r 13, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)

samochody_new_rules <- samochody_new %>%
  filter(nchar(brand) > 2) %>%
  filter(price_in_pln > 0) %>%
  filter(grepl("km", mileage)) %>%
  filter(grepl("^[a-zA-Z]+$", fuel_type)) %>%
  filter(year >= 1995) %>%
  filter(year<= 2024)

print(samochody_new_rules)
View(samochody_new_rules)
```

## Czyszczenie reginÃ³w niebÄ™dÄ…cych polskimi wojewÃ³dztwami

W posidadanych danych znajdujÄ… siÄ™ miasta spoza granic Polski. W naszej analizie chcemy siÄ™ skupiÄ‡ na danych z polskich wojewÃ³dztw, wiÄ™c pozostaÅ‚e dane zostanÄ… usuniÄ™te.

```{r 14, echo=FALSE, message=FALSE, warning=FALSE}
polskie_wojewodztwa <- c(
  "DolnoÅ›lÄ…skie", "Kujawsko-Pomorskie", "Lubelskie", 
  "Lubuskie", "ÅÃ³dzkie", "MaÅ‚opolskie", "Mazowieckie", 
  "Opolskie", "Podkarpackie", "Podlaskie", "Pomorskie", 
  "ÅšlÄ…skie", "ÅšwiÄ™tokrzyskie", "WarmiÅ„sko-Mazurskie", 
  "Wielkopolskie", "Zachodniopomorskie"
)
if (!"voivodeship" %in% colnames(samochody_new_rules)) {
  stop("Kolumna 'voivodeship' nie istnieje w danych.")
}
samochody_new_rules <- samochody_new_rules[samochody_new_rules$voivodeship %in% polskie_wojewodztwa, ]
print(head(samochody_new_rules))

```

```{r 15, echo=FALSE, message=FALSE, warning=FALSE}
zlamania <- samochody_new %>%
  summarise(
    Regula1 = sum(nchar(brand) <= 2),   
    Regula2 = sum(price_in_pln <= 0), 
    Regula3 = sum(!grepl("km", mileage)),                   
    Regula4 = sum(!grepl("^[a-zA-Z]+$", fuel_type)), 
    Regula5 = sum(year < 1995), 
    Regula6 = sum(year > 2024)
  )
print(zlamania)
```

```{r 16, echo=FALSE, message=FALSE, warning=FALSE}
zlamania_procentowo <- samochody_new %>%
  summarise(
    Regula1 = sum(nchar(brand) <= 2) / n()*100,   
    Regula2 = sum(price_in_pln <= 0) / n()*100, 
    Regula3 = sum(!grepl("km", mileage)) / n()*100,                   
    Regula4 = sum(!grepl("^[a-zA-Z]+$", fuel_type)) / n()*100, 
    Regula5 = sum(year < 1995) / n()*100, 
    Regula6 = sum(year > 2024) / n()*100
  )
print(zlamania_procentowo)
```

# WartoÅ›ci odstajÄ…ce

## Usuwanie wartoÅ›ci odstajÄ…cych dla wszystkich kolumn numerycznych

WartoÅ›ci odstajÄ…ce zaburzajÄ… rzetelnoÅ›Ä‡ analizy, wiÄ™c powinny zostaÄ‡ usuniÄ™te.

```{r 17, echo=FALSE, message=FALSE, warning=FALSE}
library(dplyr)
samochody_final <- samochody_new_rules %>%
  rowwise() %>%
  mutate(
    is_outlier = any(across(where(is.numeric), ~ . < quantile(., 0.25, na.rm = TRUE) - 1.5 * IQR(.) |
                               . > quantile(., 0.75, na.rm = TRUE) + 1.5 * IQR(.)))
  ) %>%
  ungroup() %>%
  filter(!is_outlier) %>%
  select(-is_outlier)
```

## PodglÄ…d wynikowego zbioru danych

Sprawdzanie jak wyglÄ…da finalny plik z wyczyczonymi danymi i zapisanie ich do osobnego pliku, ktÃ³ry bÄ™dzie uÅ¼yty w analizie.

```{r 18, echo=FALSE, message=FALSE, warning=FALSE}
print(samochody_final)
write.csv(samochody_final, "samochody_final.csv", row.names = FALSE)
if (file.exists("samochody_final.csv")) {
  samochody_final <- read.csv("samochody_final.csv")
} else {
  stop("Plik 'samochody_final.csv' nie zostaÅ‚ znaleziony.")
}

```

# Wizualizacja danych

## 1. Cena samochodu zaleÅ¼na od marki

```{r 19, echo=FALSE, message=FALSE, warning=FALSE}
data_top16 <- samochody_final %>%
  arrange(desc(price_in_pln)) %>%
  distinct(brand, .keep_all = TRUE) %>%  
  head(3) 

ggplot(data_top16, aes(x = reorder(brand, price_in_pln), y = price_in_pln)) +
  geom_col(fill = "pink") +  
  labs(
    title = "3 marki z najwyÅ¼szymi cenami samochodÃ³w",
    x = "Marka",
    y = "Cena samochodu (PLN)"
  ) +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"), 
    axis.title.x = element_text(size = 14, face = "bold"),
    axis.title.y = element_text(size = 14, face = "bold"), 
    axis.text.x = element_text(angle = 45, hjust = 1), 
  )
```

Wykres zawiera informacje na temat marek samochodÃ³w, ktÃ³re posiadajÄ… najwyÅ¼sze ceny. WÅ›rÃ³d producentÃ³w zauwaÅ¼amy znacznÄ… przewagÄ™ wysokoÅ›ci cen Lamborghini nad pozostaÅ‚ymi markami aut. Cena modelu Aventador S wynosi 2 550 000 zÅ‚. KolejnÄ… najdroÅ¼szÄ… markÄ… jest Ferrari, nastÄ™pnie Mercedes-Benz.

```{r 20, echo=FALSE, message=FALSE, warning=FALSE}
data_top3 <- samochody_final[order(samochody_final$price_in_pln), ][1:3, ]

ggplot(data_top3, aes(x = reorder(brand, price_in_pln), y = price_in_pln)) +
  geom_col(fill = "darkred") +  
  labs(
    title = "3 najtaÅ„sze marki samochodÃ³w",
    x = "Marka",
    y = "Cena samochodu (PLN)"
  ) +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )

```

Wykres zawiera informacje na temat marek samochodÃ³w, ktÃ³re posiadajÄ… najniÅ¼sze ceny. WÅ›rÃ³d producentÃ³w zauwaÅ¼amy, iÅ¼ najtaÅ„sze auta naleÅ¼Ä… do Opla. NajniÅ¼szym dostÄ™pnym modelem jest Opel Corsa 1.0 Swing 12 v dostÄ™pny w cenie 1 111 zÅ‚. KolejnÄ… markÄ…, ktÃ³ra posiada nieznacznie wyÅ¼sze ceny jest Deawoo, natomiast trzecim producentem, ktÃ³ry posiada najtaÅ„sze dostÄ™pne auta jest Nissan.

## 2. Cena samochodu zaleÅ¼na od daty wyprodukowania

```{r 21, echo=FALSE, message=FALSE, warning=FALSE}

library(ggplot2)
library(dplyr)

top_years <- samochody_final %>%
  group_by(year) %>%
  tally() %>%
  arrange(desc(n)) %>%
  head(3)

data_top_years <- samochody_final %>%
  filter(year %in% top_years$year)

ggplot(data_top_years, aes(x = factor(year), y = price_in_pln)) +
  geom_boxplot(fill = "purple", color = "red") + 
  labs(
    title = "Cena samochodu w zaleÅ¼noÅ›ci od roku wyprodukowania",
    x = "Rok wyprodukowania",
    y = "Cena samochodu (w PLN)"
  ) +
  theme_set(theme_minimal())
```

Wykres zawiera dane, ktÃ³re ukazujÄ…, w ktÃ³rym roku zostaÅ‚y wyprodukowane najdroÅ¼sze dostÄ™pne auta. Dostrzegamy, iÅ¼ najwiÄ™cej najdroÅ¼szych aut zostaÅ‚o wyprodukowanych w latach 2017-2019. W roku 2018 dostrzegamy najwiÄ™ksze wartoÅ›ci odstajÄ…ce- sÄ… to najdroÅ¼sze z dostÄ™pnych aut- Lamborghini Aventador S, ktÃ³rych cena wynosi 2 550 000 zÅ‚otych.

## 3. Cena samochodu zaleÅ¼na od przebiegu

```{r 22, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(samochody_final, aes(x= mileage, y= price_in_pln)) + geom_boxplot(fill = "pink", color = "red") + 
  labs(
    tittle = "Cena samochodu w zaleÅ¼noÅ›ci od przebiegu",
    x = "przebieg",
    y = "Cena samochodu (w PLN)"
  ) +
 theme_set(theme_minimal())
```

WiÄ™kszoÅ›Ä‡ punktÃ³w znajduje siÄ™ w dolnej czÄ™Å›ci wykresu, co sugeruje, Å¼e cena samochodÃ³w zazwyczaj mieÅ›ci siÄ™ w niÅ¼szym przedziale, niezaleÅ¼nie od przebiegu. Nie widaÄ‡ wyraÅºnej korelacji â€“ samochody o rÃ³Å¼nym przebiegu mogÄ… mieÄ‡ bardzo rÃ³Å¼ne ceny. WystÄ™pujÄ… pojedyncze punkty znacznie powyÅ¼ej wiÄ™kszoÅ›ci obserwacji â€“ mogÄ… to byÄ‡ luksusowe lub kolekcjonerskie pojazdy, ktÃ³rych cena jest bardzo wysoka, niezaleÅ¼nie od przebiegu.

## 4. Cena samochodu zaleÅ¼na od pojemnoÅ›ci silnika

```{r 23, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(samochody_final, aes(x= engine_capacity, y= price_in_pln)) + geom_boxplot(fill = "pink", color = "red") + 
  labs(
    tittle = "Cena samochodu w zaleÅ¼noÅ›ci od pojemnoÅ›ci silnika",
    x = "pojemnoÅ›Ä‡ silnika",
    y = "Cena samochodu (w PLN)"
  ) +
 theme_set(theme_minimal())
```

WiÄ™kszoÅ›Ä‡ samochodÃ³w ma stosunkowo niskÄ… cenÄ™, niezaleÅ¼nie od pojemnoÅ›ci silnika. WidaÄ‡ duÅ¼e zagÄ™szczenie punktÃ³w w dolnej czÄ™Å›ci wykresu. Brak wyraÅºnej liniowej zaleÅ¼noÅ›ci miÄ™dzy pojemnoÅ›ciÄ… silnika a cenÄ… â€“ cena samochodu nie roÅ›nie wprost proporcjonalnie do pojemnoÅ›ci silnika. IstniejÄ… pojedyncze punkty w gÃ³rnej czÄ™Å›ci wykresu, ktÃ³re reprezentujÄ… samochody o bardzo wysokiej wartoÅ›ci (np. luksusowe, sportowe lub kolekcjonerskie auta). WidaÄ‡, Å¼e droÅ¼sze samochody czÄ™Å›ciej majÄ… wiÄ™kszÄ… pojemnoÅ›Ä‡ silnika, ale nie jest to reguÅ‚Ä…. IstniejÄ… teÅ¼ samochody o duÅ¼ej pojemnoÅ›ci, ktÃ³re nie sÄ… szczegÃ³lnie drogie, co moÅ¼e wskazywaÄ‡ na starsze modele lub mniej prestiÅ¼owe marki.

## 5. Åšrednia cena samochodu w wojewÃ³dztwie

```{r 24, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(samochody_final, aes(x = voivodeship, y = price_in_pln, group = voivodeship)) +
  geom_line(linewidth = 1, color = "pink") +  
  geom_point(size = 2, color = "red") +    
  labs(
    title = "Zmiany cen samochodÃ³w w zaleÅ¼noÅ›ci od wojewÃ³dztw",
    x = "WojewÃ³dztwo",
    y = "Cena samochodu (PLN)"
  ) +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    legend.position = "none"  
  )
```

Wykres pokazuje rozpiÄ™toÅ›Ä‡ cen samochodÃ³w w rÃ³Å¼nych wojewÃ³dztwach w Polsce. MoÅ¼na zauwaÅ¼yÄ‡, Å¼e wojewÃ³dztwa o bardziej rozwiniÄ™tym rynku samochodowym, takie jak Mazowieckie, MaÅ‚opolskie, i ÅšlÄ…skie, charakteryzujÄ… siÄ™ najwyÅ¼szymi cenami.WojewÃ³dztwa takie jak Lubuskie, Podlaskie, i ÅšwiÄ™tokrzyskie majÄ… znacznie niÅ¼sze ceny samochodÃ³w, co moÅ¼e wynikaÄ‡ z mniejszego popytu lub braku dostÄ™pu do luksusowych modeli. WysokoÅ›Ä‡ sÅ‚upkÃ³w wskazuje na rÃ³Å¼norodnoÅ›Ä‡ cen w kaÅ¼dym wojewÃ³dztwie. PrzykÅ‚adowo, Mazowieckie i MaÅ‚opolskie majÄ… wiÄ™ksze rozpiÄ™toÅ›ci cen, co moÅ¼e wynikaÄ‡ z wiÄ™kszego rynku oraz dostÄ™pnoÅ›ci zarÃ³wno tanich, jak i drogich modeli.

## 6. 15 miast z najwyÅ¼szymi cenami samochodÃ³w

```{r 25, echo=FALSE, message=FALSE, warning=FALSE}
data_top15 <- samochody_final[order(-samochody_final$price_in_pln), ][1:15, ]
ggplot(data_top15, aes(x = reorder(city, price_in_pln), y = price_in_pln)) +
  geom_col(fill = "pink") +  
  labs(
    title = "15 miast z najwyÅ¼szymi cenami samochodÃ³w",
    x = "Miasto",
    y = "Cena samochodu (PLN)"
  ) +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```

WÅ›rÃ³d miast przedstawionych na wykresie, Warszawa wyrÃ³Å¼nia siÄ™ jako miasto z najwyÅ¼szÄ… Å›redniÄ… cenÄ… samochodÃ³w. MoÅ¼e to byÄ‡ zwiÄ…zane z wyÅ¼szÄ… siÅ‚Ä… nabywczÄ… mieszkaÅ„cÃ³w stolicy oraz wiÄ™kszym zapotrzebowaniem na pojazdy luksusowe.Miasta takie jak Katowice i PoznaÅ„ majÄ… rÃ³wnieÅ¼ wysokie ceny samochodÃ³w, co wskazuje na duÅ¼Ä… liczbÄ™ transakcji w pojazdÃ³w. LubartÃ³w oraz Wschowa znajdujÄ… siÄ™ w dolnej czÄ™Å›ci wykresu, co sugeruje, Å¼e ceny samochodÃ³w w tych miastach sÄ… niÅ¼sze w porÃ³wnaniu do pozostaÅ‚ych.

## 7. Rodzaje paliwa w polskich wojewÃ³dztwach

```{r 26, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
fuel_data <- samochody_final %>%
  count(voivodeship, fuel_type)
fuel_colors <- c(
  "Benzyna" = "pink",      
  "Diesel" = "red",        
  "Hybryda" = "purple",   
  "Elektryczny" = "maroon" 
)

ggplot(fuel_data, aes(x = voivodeship, y = n, fill = fuel_type)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = fuel_colors) + 
  labs(
    title = "Rodzaje paliwa w wojewÃ³dztwach",
    x = "WojewÃ³dztwo",
    y = "Liczba pojazdÃ³w",
    fill = "Rodzaj paliwa"
  ) +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )

```

Z wykresu moÅ¼na wyczytaÄ‡, Å¼e benzyna i diesel sÄ… najpopularniejszymi rodzajami paliwa w Polsce, a ich dominacja jest wyraÅºna w kaÅ¼dym wojewÃ³dztwie. Liczba pojazdÃ³w hybrydowych i elektrycznych jest niewielka, ale zauwaÅ¼alna w wojewÃ³dztwach bogatszych.

# Statystyki opisowe

Stworzenie kolorowej tabeli ze statystykami opisowymi.

```{r 27, echo=FALSE, message=FALSE, warning=FALSE}
library(gtsummary)
library(gt)
samochody_final %>%
  select(price_in_pln,brand) %>%
  tbl_summary(
    by=brand,
    type = all_continuous() ~ "continuous2",
    statistic = all_continuous() ~ c(
      "{N_nonmiss}","{mean}","{sd}",
      "{median} ({p25}, {p75})",
      "{min}, {max}"),
    missing = "no",
    label = price_in_pln ~ "Cena") %>%
  modify_header(label ~ "**Zmienna**") %>%
  modify_caption("**Tabela 1. Zmiana cen wedÅ‚ug marki**") %>%
  bold_labels() %>% 
  add_p(pvalue_fun = ~ style_pvalue(.x, digits = 2))%>%
  as_gt() %>%
  tab_style(
    style = list(
      cell_fill(color = "pink")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "darkred"),
      cell_text(weight = "bold", color = "white")
    ),
    locations = cells_column_labels()
  )
```

```{r 28, echo=FALSE, message=FALSE, warning=FALSE}
library(gtsummary)
samochody_new_rules %>%
  select(price_in_pln,year) %>%
  tbl_summary(
    by=year,
    type = all_continuous() ~ "continuous2",
    statistic = all_continuous() ~ c(
      "{N_nonmiss}","{mean}","{sd}",
      "{median} ({p25}, {p75})",
      "{min}, {max}"),
    missing = "no",
    label = price_in_pln ~ "Cena") %>%
  modify_header(label ~ "**Zmienna**") %>%
  modify_caption("**Tabela 1. RozkÅ‚ad cen wedÅ‚ug roku produkcji. **") %>%
  bold_labels() %>% 
  add_p(pvalue_fun = ~ style_pvalue(.x, digits = 2)) %>%
as_gt() %>%
tab_style(
    style = list(
      cell_fill(color = "pink")
    ),
    locations = cells_body()
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "darkred"),
      cell_text(weight = "bold", color = "white")
    ),
    locations = cells_column_labels()
  )
```

## 1. Hipoteza 1 -\> marka nie ma wpÅ‚ywu na cenÄ™.

H0: Åšrednie (lub mediany) cen samochodÃ³w sÄ… takie same dla wszystkich marek. Marka nie ma wpÅ‚ywu na cenÄ™ auta. H1: Przynajmniej jedna marka ma innÄ… medianÄ™ ceny niÅ¼ pozostaÅ‚e. Marka wpÅ‚ywa na cenÄ™ auta. Î± = 0,05

```{r 30, echo=FALSE, message=FALSE, warning=FALSE}

library(nortest)
ad_test <- ad.test(samochody_new_rules$price_in_pln)
print(ad_test)

```

```{r 31, echo=FALSE, message=FALSE, warning=FALSE}
library(dunn.test)
dunn_test <- dunn.test(samochody_new_rules$price_in_pln, samochody_new_rules$brand, method = "bonferroni")
print(dunn_test)

```

```{r 32, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(samochody_new_rules, aes(x = reorder(brand, price_in_pln, median), y = price_in_pln)) +
  geom_boxplot(fill = "pink", color = "darkred", alpha = 0.7) +  
  coord_flip() +
  ggtitle("RozkÅ‚ad cen samochodÃ³w dla rÃ³Å¼nych marek") +
  xlab(ğŸš— "Marka") + 
  ylab("ğŸ’° Cena w PLN") +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold", color = "darkred"),
    axis.title.x = element_text(size = 14, face = "bold", color = "pink"), 
    axis.title.y = element_text(size = 14, face = "bold", color = "pink"), 
    axis.text = element_text(size = 12, color = "darkred") # 
  )
```

## 2. Hipoteza 2 -\> Rok wyprodukwoania auta nie ma wpÅ‚ywu na cenÄ™.

H0: Åšrednie (lub mediany) cen samochodÃ³w sÄ… takie same dla wszystkich lat wyprodukowania. Rok wyprodukowania nie ma wpÅ‚ywu na cenÄ™ auta. H1: Przynajmniej jeden rok wyprodukowania ma innÄ… medianÄ™ ceny niÅ¼ pozostaÅ‚e. Rok wyprodukowania wpÅ‚ywa na cenÄ™ auta. Î± = 0,05

```{r 33, echo=FALSE, message=FALSE, warning=FALSE}
library(dunn.test)
dunn_test <- dunn.test(samochody_new_rules$price_in_pln, samochody_new_rules$year, method = "bonferroni")
print(dunn_test)

```

```{r 34, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
ggplot(samochody_new_rules, aes(x = reorder(year, price_in_pln, median), y = price_in_pln)) +
  geom_boxplot() +
  coord_flip() +
  ggtitle("RozkÅ‚ad cen samochodÃ³w dla rÃ³Å¼nych lat ich wyprodukowania") +
  xlab("Rok wyprodukowania") + ylab("Cena w PLN")

ggplot(samochody_new_rules, aes(x = reorder(year, price_in_pln, median), y = price_in_pln)) +
  geom_boxplot(fill = "pink", color = "darkred", alpha = 0.7) +  
  coord_flip() +
  ggtitle("RozkÅ‚ad cen samochodÃ³w wedÅ‚ug lat produkcji") +
  xlab("Rok wyprodukowania") + 
  ylab("Cena w PLN") +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold", color = "darkred"), 
    axis.title.x = element_text(size = 14, face = "bold", color = "pink"), 
    axis.title.y = element_text(size = 14, face = "bold", color = "pink"), 
    axis.text = element_text(size = 12, color = "darkred") 
  )
```

## 3. Hipoteza 3 -\> Przebieg auta nie ma wpÅ‚ywu na cenÄ™.

H0: Åšrednie (lub mediany) cen samochodÃ³w sÄ… takie same dla wszystkich iloÅ›ci przebiegu danego auta. Przebieg nie ma wpÅ‚ywu na cenÄ™ auta. H1: Przynajmniej jeden przebieg ma innÄ… medianÄ™ ceny niÅ¼ pozostaÅ‚e. Przebieg wpÅ‚ywa na cenÄ™ auta. Î± = 0,05

```{r 35, echo=FALSE, message=FALSE, warning=FALSE}
library(dunn.test)
dunn_test <- dunn.test(samochody_new_rules$price_in_pln, samochody_new_rules$mileage, method = "bonferroni")
print(dunn_test)

```

```{r 36, echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)

ggplot(samochody_new_rules, aes(x = reorder(mileage, price_in_pln, median), y = price_in_pln)) +
  geom_boxplot(fill = "lightpink", color = "darkred", alpha = 0.7) +  
  coord_flip() +
  ggtitle("RozkÅ‚ad cen samochodÃ³w wedÅ‚ug przebiegu") +
  xlab("Przebieg (km)") + 
  ylab("Cena w PLN") +
  theme_set(theme_minimal()) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold", color = "darkred"), 
    axis.title.x = element_text(size = 14, face = "bold", color = "pink"), 
    axis.title.y = element_text(size = 14, face = "bold", color = "pink"), 
    axis.text = element_text(size = 12, color = "darkred") 
  )

```

# Podsumowanie wnioskÃ³w.

Najistotniejszy wpÅ‚yw na cenÄ™ samochodu ma nazwa producenta- marka. Zgodnie z wykresem ukazanym w punkcie Statystyki opisowe- hipoteza 1, dostrzegamy, iÅ¼ ceny aut marek takich jak Lamborghini, Ferrari czy Aston Martin siÄ™gajÄ… powyÅ¼ej 2 milionÃ³w zÅ‚otych. RozkÅ‚Ä…d cen tych producentÃ³w jest szeroki, co sugeruje duÅ¼Ä… zmiennoÅ›Ä‡ w oferowanych modelach. Samochody klasy premium, takie jak Porshe, Land Rover, Mercedes- Benz, BMW i Maserati rÃ³wnieÅ¼ charakteryzujÄ… siÄ™ wysokimi cenami swoich samochodÃ³w, ale siÄ™gajÄ… one Å›rednio w granicy okoÅ‚o 1 do 2 milionÃ³w zÅ‚otych. Kolejno dostrzegamy marki popularne, do ktÃ³rych naleÅ¼y Toyota, Volkswagen, Hyundai, Mazda czy Kia. MajÄ… one ceny skoncentrowane w niÅ¼szych przedziaÅ‚ach cenowych, Å›rednio poniÅ¼ej 1 miliona zÅ‚otych, do okoÅ‚o 300 tysiÄ™cy zÅ‚otych. PoniÅ¼ej ceny 300 tysiÄ™cy zÅ‚otych zauwaÅ¼amy takie marki jak Daewoo, Citroen, Smart, ktÃ³re naleÅ¼Ä… do grupy najtaÅ„szych aut z caÅ‚ego zbioru. Na wykresach hipotez 2 i 3 nie dostrzegamy aÅ¼ tak wyraÅºnych rÃ³Å¼nic miÄ™dzy przedziaÅ‚ami, jak w wykresie hipotezy 1. Na rozkÅ‚ad cen aut w zaleÅ¼noÅ›ci od przebiegu czy roku wyprodukowania nie jest tak jednoznaczny, jak wykres rozkÅ‚adu cen ze wzglÄ™du na markÄ™ auta. RozkÅ‚ad cen dla kaÅ¼dej marki ukazuje wystÄ™powanie pojedyÅ„czych bardzo drogich modeli aut, ktÃ³rych jest niewiele, w porÃ³wnaniu do aut niskobudÅ¼etowych. Zgodnie z wynikami wykresÃ³w hipotez, cena auta jest zaleÅ¼na od roku wyprodukowania i przebiegu, natomiast najistotniejszy wpÅ‚yw na cenÄ™ auta ma jego nazwa producenta, czyli marka.
